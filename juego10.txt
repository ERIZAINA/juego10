<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Juego Educativo HTA - Personal Sanitario</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-pink-200 min-h-screen flex items-center justify-center">

<!-- Ranking top 10 -->
<div class="fixed top-4 right-4 bg-white p-4 rounded-xl shadow-xl w-64 text-sm">
  <h3 class="font-bold mb-2">üèÜ Ranking</h3>
  <ul id="ranking"></ul>
</div>

<!-- Tarjeta central -->
<div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-2xl text-center">

  <!-- Pantalla inicio -->
  <div id="inicio">
    <div class="text-6xl mb-4">üòä</div>
    <h1 class="text-xl font-bold mb-4">¬°Hola! Contesta a estas preguntas y aprendamos juntos</h1>
    <input id="nombre" class="border p-2 rounded w-full mb-4" placeholder="Escribe tu nombre">
    <button onclick="comenzar()" class="bg-blue-300 rounded-full px-6 py-2 hover:bg-yellow-400 hover:text-white">
      Comenzar
    </button>
  </div>

  <!-- Pantalla juego -->
  <div id="juego" class="hidden">
    <div id="emoji" class="text-6xl mb-2">üôÇ</div>
    <div id="nivelTitulo" class="font-bold mb-2"></div>
    <div id="puntuacion" class="mb-2">Puntos: 100</div>
    <div id="contador" class="mb-2 font-bold">Tiempo restante: 120 s</div>
    <p id="pregunta" class="font-semibold mb-4"></p>
    <div id="opciones" class="space-y-2"></div>
    <div id="feedback" class="mt-4 font-semibold"></div>
  </div>

  <!-- Pantalla final -->
  <div id="final" class="hidden">
    <div class="text-6xl mb-4">üéâ</div>
    <p id="mensajeFinal" class="mb-4"></p>
    <button onclick="reiniciar()" class="bg-blue-300 rounded-full px-6 py-2 hover:bg-yellow-400 hover:text-white">
      Volver a jugar
    </button>
  </div>
</div>

<script>
/* ==================== VARIABLES ==================== */
let jugador = "";
let puntos = 100;
let preguntaActual = 0;
let nivelActual = 0;
let tiempoRestante = 120;
let intervaloTiempo;

/* ==================== NIVELES Y PREGUNTAS ==================== */
const niveles = [
  /* Nivel 0 */
  {
    titulo: "Nivel 0 ‚Äì B√∫squeda bibliogr√°fica HTA",
    preguntas: [
      {p:"Para conocer la prevalencia real de HTA en poblaci√≥n, reviso:", o:["Bases de datos cient√≠ficas","Redes sociales","Opiniones personales"], c:0, fc:"Correcto, PubMed y otras bases son fiables.", fi:"Opiniones personales o redes sociales no son v√°lidas."},
      {p:"Dise√±o t√≠pico de estudios de prevalencia:", o:["Transversal","Ensayo cl√≠nico","Caso-control"], c:0, fc:"Correcto, mide frecuencia en un momento dado.", fi:"Otros dise√±os son para otras preguntas."},
      {p:"Comparo mis resultados con la bibliograf√≠a para:", o:["Interpretar datos","Modificar resultados","Evitar an√°lisis"], c:0, fc:"Exacto, ayuda a contextualizar.", fi:"Modificar datos no es correcto."},
      {p:"La definici√≥n de HTA influye en:", o:["La prevalencia reportada","Nada","Solo legales"], c:0, fc:"Correcto, diferentes definiciones cambian resultados.", fi:"Influye directamente en resultados."},
      {p:"Una b√∫squeda reproducible debe:", o:["Describir estrategia","Buscar r√°pido","Usar intuici√≥n"], c:0, fc:"Correcto, permite evaluaci√≥n externa.", fi:"Intuici√≥n no es m√©todo cient√≠fico."}
    ]
  },
  /* Nivel 1 */
  {
    titulo: "Nivel 1 ‚Äì Prevalencia en consulta",
    preguntas: [
      {p:"Reviso 200 pacientes y 58 tienen HTA. Prevalencia:", o:["29%","58%","71%"], c:0, fc:"Correcto, 58/200 = 29%.", fi:"Prevalencia = casos/total."},
      {p:"La media de la tensi√≥n arterial sist√≥lica de mis pacientes me permite:", o:["Analizar la muestra","Diagnosticar autom√°ticamente","Cambiar f√°rmacos"], c:0, fc:"Correcto, media describe la muestra.", fi:"No diagnostica individualmente."},
      {p:"La prevalencia indica:", o:["Proporci√≥n de pacientes con HTA","Causa de HTA","Pron√≥stico exacto"], c:0, fc:"Correcto, frecuencia de la condici√≥n.", fi:"No indica causalidad."},
      {p:"Para extrapolar datos a la poblaci√≥n, necesito:", o:["Muestra representativa","Muchos pacientes","Que todos tengan HTA"], c:0, fc:"Correcto, representatividad es clave.", fi:"Solo tama√±o no basta."},
      {p:"Si hay registros faltantes de TA:", o:["La prevalencia puede subestimarse","Aumenta","No cambia"], c:0, fc:"Correcto, falta de datos afecta resultados.", fi:"Siempre afecta a la validez."}
    ]
  },
  /* Nivel 2 */
  {
    titulo: "Nivel 2 ‚Äì Estad√≠stica descriptiva",
    preguntas: [
      {p:"Calculo la media de PAD para:", o:["Describir la muestra","Diagnosticar","Comparar tratamientos"], c:0, fc:"Correcto, media describe la muestra.", fi:"No sirve para diagn√≥stico."},
      {p:"Desviaci√≥n est√°ndar indica:", o:["Dispersi√≥n","Valor central","Frecuencia"], c:0, fc:"Correcto, mide variabilidad.", fi:"No mide tendencia central."},
      {p:"Mediana es √∫til porque:", o:["No afecta extremos","Siempre mayor que media","Es igual a moda"], c:0, fc:"Correcto, complementa la media.", fi:"Cada medida tiene un uso."},
      {p:"Rango intercuart√≠lico describe:", o:["Dispersi√≥n central","Valor m√°ximo","Promedio"], c:0, fc:"Correcto, valores centrales 50% datos.", fi:"No es promedio ni m√°ximo."},
      {p:"Nivel Comisi√≥n Formaci√≥n:", o:["Interpretar descriptiva","Memorizar","Suerte"], c:0, fc:"Correcto, aplica a pr√°ctica cl√≠nica.", fi:"No es azar."}
    ]
  },
  /* Nivel 3 */
  {
    titulo: "Nivel 3 ‚Äì Inferencia poblacional",
    preguntas: [
      {p:"IC 95% para media PAD: 77,49‚Äì90,51. Valor referencia 74,4 mmHg. ¬øCompatible?", o:["Es compatible","No hay diferencias","Hay diferencia estad√≠sticamente significativa"], c:2, fc:"Correcto, valor fuera del IC ‚Üí diferencia significativa.", fi:"Si est√° fuera del IC, hay diferencia."},
      {p:"p-valor 0,0087 indica:", o:["Significativo","No significativo","Error"], c:0, fc:"Correcto, p < 0,05 ‚Üí significativo.", fi:"Indica evidencia estad√≠stica."},
      {p:"Si IC incluye valor referencia:", o:["Compatible","Diferente","No s√©"], c:0, fc:"Correcto, compatible con valor poblacional.", fi:"No hay diferencia estad√≠stica."},
      {p:"Inferencia sobre proporci√≥n de HTA en muestra:", o:["Proporci√≥n v√°lida para poblaci√≥n","Error","No √∫til"], c:0, fc:"Correcto, permite estimar frecuencia poblacional.", fi:"No es inv√°lida."},
      {p:"Valor 74,4 mmHg no est√° dentro del IC 95 %. Concluyo:", o:["Es compatible","No hay diferencias","Hay diferencia estad√≠sticamente significativa"], c:2, fc:"Correcto, diferencia significativa.", fi:"Valor fuera del IC ‚Üí diferencia estad√≠stica."}
    ]
  },
  /* Nivel 4 */
  {
    titulo: "Nivel 4 ‚Äì Asociaci√≥n educaci√≥n sanitaria e HTA",
    preguntas: [
      {p:"Observando la tabla 2x2: m√°s HTA en:", o:["Con educaci√≥n","Sin educaci√≥n","Igual"], c:1, fc:"Correcto, hay m√°s HTA sin educaci√≥n.", fi:"Observa distribuci√≥n."},
      {p:"Prueba estad√≠stica adecuada:", o:["t de Student","Correlaci√≥n","Chi-cuadrado"], c:2, fc:"Correcto, œá¬≤ analiza cualitativas.", fi:"t se usa para medias."},
      {p:"œá¬≤=8,60; p=0,003. ¬øConclusi√≥n?", o:["Causalidad","Asociaci√≥n significativa","No hay relaci√≥n"], c:1, fc:"Correcto, asociaci√≥n estad√≠stica.", fi:"Asociaci√≥n ‚â† causalidad."},
      {p:"Condici√≥n validez:", o:["Muestra aleatoria y definici√≥n clara","Elegir solo sin HTA","Datos otro hospital"], c:0, fc:"Correcto, representa adecuadamente la poblaci√≥n.", fi:"Sin representatividad no sirve."},
      {p:"Nivel Comisi√≥n Formaci√≥n:", o:["Analizar asociaci√≥n","Solo f√≥rmulas","Memorizar"], c:0, fc:"Correcto, aplica inferencia real.", fi:"No memorizar."}
    ]
  },
  /* Nivel 5 */
  {
    titulo: "Nivel 5 ‚Äì Aplicaci√≥n gu√≠as pr√°cticas",
    preguntas: [
      {p:"Conocer prevalencia HTA me permite:", o:["Planificar educaci√≥n","Cambiar f√°rmacos","Diagn√≥stico autom√°tico"], c:0, fc:"Correcto, facilita planificaci√≥n.", fi:"No sustituye valoraci√≥n cl√≠nica."},
      {p:"Aplicaci√≥n gu√≠as mejora:", o:["Calidad de cuidados","Burocracia","Carga laboral"], c:0, fc:"Correcto, basada en evidencia.", fi:"No aumenta burocracia."},
      {p:"Decisi√≥n en consulta basada en evidencia:", o:["Aplicar recomendaciones","Ignorar gu√≠as","Suerte"], c:0, fc:"Correcto, gu√≠as apoyan pr√°ctica cl√≠nica.", fi:"No es azar."},
      {p:"Evaluar efectividad intervenci√≥n:", o:["Medir resultados","Adivinar","Solo opini√≥n"], c:0, fc:"Correcto, datos objetivos.", fi:"Opini√≥n no es evidencia."},
      {p:"Nivel Comisi√≥n Formaci√≥n:", o:["Revisi√≥n gu√≠as","Memorizar","Suerte"], c:0, fc:"Correcto, fomenta evidencia.", fi:"No memorizar."}
    ]
  }
];

/* ==================== FUNCIONES ==================== */
function comenzar() {
  jugador = document.getElementById("nombre").value.trim();
  if (!jugador) return alert("Introduce tu nombre");

  const progreso = JSON.parse(localStorage.getItem("progreso_" + jugador));
  if (progreso) {
    puntos = progreso.puntos;
    preguntaActual = progreso.preguntaActual;
    nivelActual = progreso.nivelActual;
  } else {
    puntos = 100; preguntaActual = 0; nivelActual = 0;
  }

  let jugadores = JSON.parse(localStorage.getItem("jugadores")) || [];
  if (jugadores.includes(jugador) && !progreso) {
    return alert("Este jugador ya complet√≥ el juego. Solo se permite un intento.");
  } else if (!progreso) {
    jugadores.push(jugador);
    localStorage.setItem("jugadores", JSON.stringify(jugadores));
  }

  document.getElementById("inicio").classList.add("hidden");
  document.getElementById("juego").classList.remove("hidden");
  tiempoRestante = 120;
  iniciarContador();
  cargarPregunta();
}

function iniciarContador() {
  document.getElementById("contador").innerText = "Tiempo restante: " + tiempoRestante + " s";
  clearInterval(intervaloTiempo);
  intervaloTiempo = setInterval(() => {
    tiempoRestante--;
    document.getElementById("contador").innerText = "Tiempo restante: " + tiempoRestante + " s";
    if (tiempoRestante <= 0) {
      clearInterval(intervaloTiempo);
      responder(-1);
    }
  }, 1000);
}

function cargarPregunta() {
  if (nivelActual >= niveles.length) return finalizar();
  const nivel = niveles[nivelActual];
  if (preguntaActual >= nivel.preguntas.length) { nivelActual++; preguntaActual=0; tiempoRestante=120; iniciarContador(); cargarPregunta(); return; }

  const q = nivel.preguntas[preguntaActual];
  document.getElementById("nivelTitulo").innerText = nivel.titulo;
  document.getElementById("pregunta").innerText = q.p;
  document.getElementById("feedback").innerText = "";
  document.getElementById("puntuacion").innerText = "Puntos: " + puntos;
  actualizarEmoji();

  const cont = document.getElementById("opciones");
  cont.innerHTML = "";
  let indices = [0,1,2];
  indices.sort(() => Math.random()-0.5);
  indices.forEach(i => {
    const btn = document.createElement("button");
    btn.innerText = q.o[i];
    btn.className = "block w-full bg-blue-200 rounded-full px-4 py-2 hover:bg-green-500 hover:text-white";
    btn.onclick = () => responder(i);
    cont.appendChild(btn);
  });
}

function responder(i) {
  clearInterval(intervaloTiempo);
  const nivel = niveles[nivelActual];
  const q = nivel.preguntas[preguntaActual];
  const fb = document.getElementById("feedback");

  let puntosPregunta = Math.max(1, Math.floor((tiempoRestante/120)*10));
  if (i === q.c) { puntos += puntosPregunta; fb.innerText = "‚úÖ " + q.fc; }
  else { puntos -= 5; fb.innerText = "‚ùå " + q.fi; }

  localStorage.setItem("progreso_" + jugador, JSON.stringify({ puntos, preguntaActual: preguntaActual+1, nivelActual }));

  setTimeout(() => {
    preguntaActual++;
    tiempoRestante=120;
    iniciarContador();
    cargarPregunta();
  }, 1200);
}

function actualizarEmoji() {
  const e = document.getElementById("emoji");
  if (puntos >= 120) e.innerText = "ü§©";
  else if (puntos >= 80) e.innerText = "üôÇ";
  else e.innerText = "üò¢";
}

function finalizar() {
  clearInterval(intervaloTiempo);
  localStorage.removeItem("progreso_" + jugador);

  document.getElementById("juego").classList.add("hidden");
  document.getElementById("final").classList.remove("hidden");
  document.getElementById("mensajeFinal").innerText = `${jugador}, tu puntuaci√≥n final es ${puntos}`;

  let r = JSON.parse(localStorage.getItem("ranking")) || [];
  r.unshift({ nombre: jugador, puntos });
  r = r.slice(0, 10);
  localStorage.setItem("ranking", JSON.stringify(r));
  mostrarRanking();
}

function mostrarRanking() {
  const ul = document.getElementById("ranking");
  ul.innerHTML = "";
  (JSON.parse(localStorage.getItem("ranking")) || []).forEach(e => {
    ul.innerHTML += `<li>${e.nombre}: ${e.puntos}</li>`;
  });
}

function reiniciar() { location.reload(); }

mostrarRanking();
</script>
</body>
</html>
